
[default]

exten => uri_test,1,NoOp()
same => n,Set(uri=${LOCAL(ARG1)})
same => n,Set(type=${LOCAL(ARG2)})
same => n,Set(expected=${LOCAL(ARG3)})
same => n,Verbose(1, Calling PJSIP_PARSE_URI for URI ${uri}, type ${type})
same => n,GotoIf($["${PJSIP_PARSE_URI(${uri},${type})}"="${expected}"]?pass)
same => n,UserEvent(Result, Status: failed, Message: ${uri}, ${type} did not match expected value ${expected} - actual ${PJSIP_PARSE_URI(${uri},${type})})
same => n(pass),NoOp()
same => n,Return()

exten => s,1,NoOp()
same => n,Answer()

; Test entries
same => n,GoSub(default,uri_test,1(sip:localhost,host,localhost))
same => n,GoSub(default,uri_test,1(sip:user@localhost,user,user))
same => n,GoSub(default,uri_test,1(sip:user@localhost,host,localhost))
same => n,GoSub(default,uri_test,1(sip:user:password@localhost:5060,user,user))
same => n,GoSub(default,uri_test,1(sip:user:password@localhost:5060,passwd,password))
same => n,GoSub(default,uri_test,1(sip:user:password@localhost:5060,host,localhost))
same => n,GoSub(default,uri_test,1(sip:user:password@localhost:5060,port,5060))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,host,localhost))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,transport_param,tcp))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,user_param,ip))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,ttl_param,255))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,lr_param,1))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,maddr_param,127.0.0.1))
same => n,GoSub(default,uri_test,1(sip:localhost\;transport=tcp\;user=ip\;ttl=255\;lr\;maddr=127.0.0.1\;method=ACK,method_param,ACK))
same => n,GoSub(default,uri_test,1(sips:localhost,scheme,sips))
same => n,GoSub(default,uri_test,1(sips:localhost,host,localhost))
same => n,GoSub(default,uri_test,1(  Power Administrator  <sips:localhost>,display,Power Administrator))
same => n,GoSub(default,uri_test,1(  Power Administrator  <sips:localhost>,host,localhost))
same => n,GoSub(default,uri_test,1( "User" <sip:user@localhost:5071>,display,User))
same => n,GoSub(default,uri_test,1( "User" <sip:user@localhost:5071>,user,user))
same => n,GoSub(default,uri_test,1( "User" <sip:user@localhost:5071>,host,localhost))
same => n,GoSub(default,uri_test,1( "User" <sip:user@localhost:5071>,port,5071))
same => n,GoSub(default,uri_test,1(This is -. !% *_+`'~ me <sip:a19A&=+$\;?/%2d:%40a&Zz=+$@my_proxy09.MY-domain.com:9801>,display,This is -. !% *_+`'~ me))
same => n,GoSub(default,uri_test,1(This is -. !% *_+`'~ me <sip:a19A&=+$\;?/%2d:%40a&Zz=+$@my_proxy09.MY-domain.com:9801>,user,a19A&=+$\;?/-))
same => n,GoSub(default,uri_test,1(This is -. !% *_+`'~ me <sip:a19A&=+$\;?/%2d:%40a&Zz=+$@my_proxy09.MY-domain.com:9801>,passwd,@a&Zz=+$))
same => n,GoSub(default,uri_test,1(This is -. !% *_+`'~ me <sip:a19A&=+$\;?/%2d:%40a&Zz=+$@my_proxy09.MY-domain.com:9801>,host,my_proxy09.MY-domain.com))
same => n,GoSub(default,uri_test,1(This is -. !% *_+`'~ me <sip:a19A&=+$\;?/%2d:%40a&Zz=+$@my_proxy09.MY-domain.com:9801>,port,9801))
same => n,GoSub(default,uri_test,1(sip:abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.com,host,abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.com))
same => n,GoSub(default,uri_test,1(sip:user@[::1]\;maddr=[::01],user,user))
same => n,GoSub(default,uri_test,1(sip:user@[::1]\;maddr=[::01],host,::1))
same => n,GoSub(default,uri_test,1(sip:user@[::1]\;maddr=[::01],maddr_param,[::01]))
same => n,GoSub(default,uri_test,1(sip:[::1]\;maddr=[::01],host,::1))
same => n,GoSub(default,uri_test,1(sip:[::1]\;maddr=[::01],maddr_param,[::01]))

same => n,UserEvent(Result, Status: passed)
same => n,Hangup()
